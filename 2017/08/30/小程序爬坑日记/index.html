<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ljybill</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="小程序爬坑日记最近因公司安排首次接触了微信小程序的开发，本来仗着有Vue的基础以为很简单，没想到开发过程中还是遇到了很多坑，不过只是接触了一个小程序的案例，好多官方api接口还没有使用过，以后有了新坑再补上。  注意本文默认你已经掌握了小程序的基本开发知识或者研读过小程序的官方文档  整体框架配置小程序的官方文档，介绍了整体框架的设置，里面的配置都是在.json文件中实现的。大致配置官方文档里都有">
<meta property="og:type" content="article">
<meta property="og:title" content="ljybill">
<meta property="og:url" content="http://yoursite.com/2017/08/30/小程序爬坑日记/index.html">
<meta property="og:site_name" content="ljybill">
<meta property="og:description" content="小程序爬坑日记最近因公司安排首次接触了微信小程序的开发，本来仗着有Vue的基础以为很简单，没想到开发过程中还是遇到了很多坑，不过只是接触了一个小程序的案例，好多官方api接口还没有使用过，以后有了新坑再补上。  注意本文默认你已经掌握了小程序的基本开发知识或者研读过小程序的官方文档  整体框架配置小程序的官方文档，介绍了整体框架的设置，里面的配置都是在.json文件中实现的。大致配置官方文档里都有">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-08-31T06:14:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ljybill">
<meta name="twitter:description" content="小程序爬坑日记最近因公司安排首次接触了微信小程序的开发，本来仗着有Vue的基础以为很简单，没想到开发过程中还是遇到了很多坑，不过只是接触了一个小程序的案例，好多官方api接口还没有使用过，以后有了新坑再补上。  注意本文默认你已经掌握了小程序的基本开发知识或者研读过小程序的官方文档  整体框架配置小程序的官方文档，介绍了整体框架的设置，里面的配置都是在.json文件中实现的。大致配置官方文档里都有">
  
    <link rel="alternate" href="/atom.xml" title="ljybill" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ljybill</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">分享就是进步</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-小程序爬坑日记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/30/小程序爬坑日记/" class="article-date">
  <time datetime="2017-08-30T14:16:18.000Z" itemprop="datePublished">2017-08-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="小程序爬坑日记"><a href="#小程序爬坑日记" class="headerlink" title="小程序爬坑日记"></a>小程序爬坑日记</h1><p>最近因公司安排首次接触了微信小程序的开发，本来仗着有Vue的基础以为很简单，没想到开发过程中还是遇到了很多坑，不过只是接触了一个小程序的案例，好多官方api接口还没有使用过，以后有了新坑再补上。</p>
<blockquote>
<p>注意本文默认你已经掌握了小程序的基本开发知识或者研读过小程序的<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/component/" target="_blank" rel="external">官方文档</a></p>
</blockquote>
<h2 id="整体框架"><a href="#整体框架" class="headerlink" title="整体框架"></a>整体框架</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>小程序的官方文档，介绍了整体框架的设置，里面的配置都是在.json文件中实现的。大致配置官方文档里都有详细的说明，多说一句<code>navigationBarTitleText</code>如果你希望一个page复用，并且名字不一样的时候，最好在app.json里面把这项置为空字符串，然后再具体页面通过<code>wx.setNavigationBarTitle</code>动态修改，不然会有一个跳动的感觉。在使用<code>enablePullDownRefresh</code>的时候，建议把<code>backgroundTextStyle</code>的值写为<code>dark</code>，是一个符合大众口味的样式。</p>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>小程序的页面维护在一个最大长度为5的堆栈中，创建新的页面会执行对应页面的onLoad函数并且压入到栈中，返回已存在的函数只会执行onShow函数。这个规则可能会影响到我们想自定义路由跳转的设计，所以在设计页面跳转时候，要考虑栈的前后。另外，关于路由跳转，建议使用js代码实现，这样可以判断是否跳转以及跳转到何处，如果固定连接可以使用<code>navigate</code>标签</p>
<h3 id="页面间传值"><a href="#页面间传值" class="headerlink" title="页面间传值"></a>页面间传值</h3><p>各个页面间传递数据也是经常出现的场景，不过小程序在这块的支持也不是很好，可以通过如下代码进行简单的query传值</p>
<pre><code>wx.navigateTo({
    url: &apos;/pages/index/index?key=&apos;+value,
})
</code></pre><p>但是如果传递对象就有些困难了，此处的解决方案有两个，一是放到app.globalData中，二是放到storage中:<code>wx.setStorageSync(&#39;key&#39;,JSON.stringify(objectValue))</code></p>
<h3 id="运行机制"><a href="#运行机制" class="headerlink" title="运行机制"></a>运行机制</h3><blockquote>
<ul>
<li>小程序没有重启的概念 </li>
<li>当小程序进入后台，客户端会维持一段时间的运行状态，超过一定时间后（目前是5分钟）会被微信主动销毁</li>
<li>置顶的小程序不会被微信主动销毁 </li>
<li>当收到系统内存告警也会进行小程序的销毁</li>
</ul>
</blockquote>
<p>运行机制在小程序的官方文档中有介绍，不过由于位置不显眼，所以单独在这贴一下，至于如何维护小程序的运行机制以及用户从后台回到小程序任意页面后期望的反应，需要在实践中尝试了。</p>
<h2 id="表现方面"><a href="#表现方面" class="headerlink" title="表现方面"></a>表现方面</h2><h3 id="px，pt和rpx"><a href="#px，pt和rpx" class="headerlink" title="px，pt和rpx"></a>px，pt和rpx</h3><p>rpx是小程序独有的单位长度，在我理解中是和rem一样的东西，因为它们都会根据设备视口的实际大小调整真实的长度。那么前端拿到设计稿后是如何换算的呢。目前看来<code>1pt=1rpx</code>，<code>1px=2rpx</code>是合适的方案。</p>
<h3 id="组件的使用"><a href="#组件的使用" class="headerlink" title="组件的使用"></a>组件的使用</h3><p>一开始打开小程序的<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/component/" target="_blank" rel="external">官方文档</a>，发现很多封装好的组件很开心，感觉省了好多事，在实践后才发现，小程序很多组件都不能用，一用就出事，<br>所以在做小程序开发时候，尽量避免使用很多奇怪的组件(包括text)。不过在项目开发过程中，总是有些需求要迎坑而踩的。大概描述下本人实践过程中的痛点。</p>
<h4 id="text"><a href="#text" class="headerlink" title="text"></a>text</h4><p>针对text我只想说：能用view就别用text。text可以类比html中的<code>span</code>标签，但是很奇怪的一点是，text中竟然还包着一个span标签，虽然大部分样式是可以继承的，但是总有点别扭的感觉，让你觉得不可以完全把控它，所以能用view还是用view吧。</p>
<h4 id="input"><a href="#input" class="headerlink" title="input"></a>input</h4><p>input和textarea都属于有用户输入交互的组件，在vue.js中针对表单组件，是有v-modal=”value”双向数据绑定机制的(虽然也是语法糖),在小程序中是需要通过<code>data=&quot;&quot; bindinput=&quot;&quot;</code>实现双向数据绑定的，再加上小程序渲染页面需要显式调用<code>setData</code>方法，所以导致了输入表单组件的数据更新不及时，在用户使用时具体就体现在，用户快速增加／删除文字时会有回退的效果。</p>
<h4 id="textarea"><a href="#textarea" class="headerlink" title="textarea"></a>textarea</h4><p>textarea还得单独说一下，因为它实在是太坑了！和text一样，textarea里面也封装了一个其他的区块，并且你无法操作它，只能改变他的父级textarea，这种情况就导致了它很难和其他组件实现水平对齐；在还不算完，textarea还拥有最高的层级(z-index = ∞)，所以你即使加了蒙层的话，他还是会比你的蒙层高，这在手机端的体验是很不好的。所以目前大的互联网公司小程序textarea的解决方案是，把它放到一个单独的页面上去，避免上面提到的两种情况的发生。</p>
<h4 id="scroll-view，swiper"><a href="#scroll-view，swiper" class="headerlink" title="scroll-view，swiper"></a>scroll-view，swiper</h4><p>两个都是可滚动的容器，其中swiper是类似轮播图似的容器，支持横向和纵向滚动两种模式，具体可查看官方文档，scroll-view则是一个滚动的容器，一般的滚动效果可用直接用view实现，如果真的需要用到scroll-view的话，必须要注意一点，那就是一定要给scroll-view一个确定的高度／宽度，上面提到小程序的长度单位是rpx，而此处scroll-view需要的长度单位是px，这就很尴尬了。好在小程序api有个<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/systeminfo.html#wxgetsysteminfoobject" target="_blank" rel="external">getSystemInfo</a>接口，希望可以帮到你。</p>
<h4 id="button"><a href="#button" class="headerlink" title="button"></a>button</h4><p>其实button组件还是没什么坑的，注意下button有默认的disabled样式就可以了，可以在app.wsxx全局样式表中设置<code>button[disabled]{...}</code>,修改button的默认样式</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>小程序官方api大部分是wx.api(object)的格式，其中入参object中一般包含3个回调函数，分别是success，fail，complete</p>
<h3 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h3><p>虽然小程序自己支持了promise，但是真机使用时发现，ios8版本是无效的，所以需要引入一个promise.min的支持库，并且实例化对象，开发过程中发现require不起作用，建议用import方式引入。</p>
<h3 id="request"><a href="#request" class="headerlink" title="request"></a>request</h3><p>作为小程序最最重要的一个api，request使用起来没有什么难度。看过官方文档的例子后就可以上手使用了，需要注意的是，小程序最多允许并发5个request请求，而且request在实际使用过程中，都会被封装一层，以便完成一些希望统一处理的情况。</p>
<h3 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h3><p>和webStorage一样，微信小程序的Storage是永久保存在本地的一个数据，并不会被会话结束所影响。同时Storage有两种使用方法，一种是异步的<code>wx.setStorage({key,value,callBackFn})</code> <code>wx.getStorage({key,callBackFn})</code>,一种是同步的<code>wx.setStorage(key,value)</code> <code>wx.getStorage(key)</code>。个人感觉同步方法使用的多一点，毕竟数据得不到对于后续操作应该会有影响的。另外storage还有两个不常用的操作：<code>wx.removeStorage()</code> <code>wx.clearStorage()</code>,可在官方文档中找到代码例子。</p>
<h3 id="getLocation、chooseLocation、openLocation"><a href="#getLocation、chooseLocation、openLocation" class="headerlink" title="getLocation、chooseLocation、openLocation"></a>getLocation、chooseLocation、openLocation</h3><p>获取用户的地理位置信息，使用户选择地理位置信息也是经常出现的场景。其中getLocation和ChooseLocation会申请用户位置信息的授权，如果用户拒绝后，以后每次调用这两个接口都会自动执行fail的callback，所以需要在这个回调里写引导用户重新授权的逻辑。</p>
<pre><code>fail() {
    wx.getSetting({
      success: (res1) =&gt; {
        console.log(res1)
        if (!res1.authSetting[&apos;scope.userLocation&apos;]) {
          wx.openSetting({
            success: (res2) =&gt; {
              wx.chooseLocation({
                success: function (res3) {

                }
              })
            }
          })
        }
      }
    })
  }
</code></pre><p>openLocation这个接口是提供一组经纬度，然后调用地图打开并显示该地址，此处注意目前这个接口支持的经纬度格式是<code>gcj02</code>不懂这个格式也没关系，只要看看官方文档的例子就知道传什么类型的值了，不过对于js这种弱类型语言，你的经纬度很可能会转换成string类型的，并且你在模拟器上看不出任何差别，不过在手机上，openLocation接口如果接受了string类型的经纬度可能会引起不工作的情况，所以保险起见，要手动转一下类型：</p>
<pre><code>wx.openLocation({
    latitude: parseFloat(latitude),
    longitude: parseFloat(longitude),
    scale: 14
})
</code></pre><h3 id="getSystemInfo"><a href="#getSystemInfo" class="headerlink" title="getSystemInfo"></a>getSystemInfo</h3><p>获取系统信息可以获取到手机的各个详细信息，官方文档有详细说明此处不在赘述，只是提一个使用到的场景：通过这个接口获取到视口高度从而进行计算。一般会在scroll-view中用到。</p>
<h3 id="showToast、showModal、showLoading"><a href="#showToast、showModal、showLoading" class="headerlink" title="showToast、showModal、showLoading"></a>showToast、showModal、showLoading</h3><p>这三个接口都是用户交互反馈的手段，toast是一个不需要用户点击的提示；modal是一个需要用户点击的对话框，有确认和可选的取消按钮，其中按钮的文字也可以修改；loading是一个不可穿透的图标，告知用户后台逻辑正在计算，一般应用在request等待回文的过程中，注意loding需要手动关闭，所以hideLoading放到complete中比较稳妥。</p>
<p>toast中的文字可能会有省略成…的情况，所以在设计提示文案时要考虑字数，原生支持两种图标，如果需要自定义自己切图就可以了。</p>
<pre><code>wx.showToast({
    title: message,
    image: &apos;/images/icon.png&apos;,
    mask: false,
    duration: 1500
})
</code></pre><h3 id="login、getUserInfo"><a href="#login、getUserInfo" class="headerlink" title="login、getUserInfo"></a>login、getUserInfo</h3><p>login和getUserInfo可以使小程序获取到微信用户的基本信息，对于分析用户数据有很重要的作用。其中getUserInfo是需要用户授权的。</p>
<h2 id="关于模版"><a href="#关于模版" class="headerlink" title="关于模版"></a>关于模版</h2><p>前端组件化开发的思想越来越重要，模板正是小程序组件化开发的体现，但是目前这个模板机制还不是很好，比如我们可以在template里面定义结构和样式，但是其中触发的事件还是得写到引用模板的js中，解决方案是可以在js中引入公共的模块实现。</p>
<h2 id="结尾的话"><a href="#结尾的话" class="headerlink" title="结尾的话"></a>结尾的话</h2><p>小程序的开发过程可谓是痛苦并学习着，作为被Vuejs惯坏了的前端，写小程序有很多不方便的地方，但是仅仅一个项目并不能用到小程序的所有特性，还有很多接口没有尝试。以后计划打算使用socket进行通讯，尝试一下用户的图片和录音功能，尝试小程序的动画接口，尝试小程序的获取元素信息接口以便开发适应各个屏幕的结构。<strong>努力努力再努力！</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/30/小程序爬坑日记/" data-id="cj702ag04000034s6fk7upfdj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/08/30/小程序爬坑日记/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 ljybill<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>